//1% transaction cost
// ATM Delta


#include <Expiry_dates.afl>

StaticVarRemove("*");
leverage = 1; 

//SetOption("MaxOpenPositions",1);
SetOption("MaxOpenShort",1);
SetOption("MaxOpenLong",1);
SetOption("AllowPositionShrinking",True);
SetOption("DisableRuinStop",True);
SetOption("PriceBoundChecking",False);
SetOption("CommissionMode",1);
SetOption("CommissionAmount",1);
SetOption("AllowSameBarExit",True);
SetOption("UsePrevBarEquityForPosSizing",True);
SetOption("InitialEquity",1000000); 


x=8;
if(x==1){sym = "AUBANK";}
if(x==2){sym = "AXISBANK"; }
if(x==3){sym = "BANDHANBNK"; }
if(x==4){sym = "BANKBARODA"; }
if(x==5){sym = "BANKINDIA"; }
if(x==6){sym = "CANBK"; }
if(x==7){sym = "FEDERALBNK"; }
if(x==8){sym = "HDFCBANK"; }
if(x==9){sym = "ICICIBANK"; }
if(x==10){sym = "IDBI"; }
if(x==11){sym = "IDFCFIRSTB"; }
if(x==12){sym = "INDUSINDBK"; }
if(x==13){sym = "KOTAKBANK"; }
if(x==14){sym = "PNB"; }
if(x==15){sym = "RBLBANK"; }
if(x==16){sym = "SBIN"; }
if(x==17){sym = "UNIONBANK"; }
if(x==18){sym = "YESBANK"; }
if(x==19){sym = "BANKNIFTYWEEKLY"; } // Name might change check
num = StrLen(sym)+4;

//cases = 2;
cases = 2;//Optimize("cases",2,1,4,1);
if(cases == 1){y = in5Minute;}
if(cases == 2){y = in15Minute;}
if(cases == 3){y = in15Minute*2;}
if(cases == 4){y = inHourly;}


SetForeign("Fixed"+sym+".EQ-NSE - I");
TimeFrameSet(y);
//ACC = 0.02;
ACC = Optimize("ACC",0.02,0.01,0.04,0.01);
PSAR = SAR(ACC,ACC);
EQClose = Close;
RestorePriceArrays();

FinalStockEQClose = TimeFrameExpand(EQClose,y,expandFirst);
PSARFinal = TimeFrameExpand(PSAR,y,expandFirst);


//monthly expiry
expday = monthlyexpiry;//iif(Datenum()>=1110101 and Datenum()<=1110127,1110127,iif(Datenum()>=1110128 and Datenum()<=1110224,1110224,	iif(Datenum()>=1110225 and Datenum()<=1110331,1110331,	iif(Datenum()>=1110401 and Datenum()<=1110428,1110428,	iif(Datenum()>=1110429 and Datenum()<=1110526,1110526,	iif(Datenum()>=1110527 and Datenum()<=1110630,1110630,	iif(Datenum()>=1110701 and Datenum()<=1110728,1110728,	iif(Datenum()>=1110729 and Datenum()<=1110825,1110825,	iif(Datenum()>=1110826 and Datenum()<=1110929,1110929,	iif(Datenum()>=1110930 and Datenum()<=1111025,1111025,	iif(Datenum()>=1111026 and Datenum()<=1111124,1111124,	iif(Datenum()>=1111125 and Datenum()<=1111229,1111229,	iif(Datenum()>=1111230 and Datenum()<=1120125,1120125,	iif(Datenum()>=1120126 and Datenum()<=1120223,1120223,	iif(Datenum()>=1120224 and Datenum()<=1120329,1120329,	iif(Datenum()>=1120330 and Datenum()<=1120426,1120426,	iif(Datenum()>=1120427 and Datenum()<=1120531,1120531,	iif(Datenum()>=1120601 and Datenum()<=1120628,1120628,	iif(Datenum()>=1120629 and Datenum()<=1120726,1120726,	iif(Datenum()>=1120727 and Datenum()<=1120830,1120830,	iif(Datenum()>=1120831 and Datenum()<=1120927,1120927,	iif(Datenum()>=1120928 and Datenum()<=1121025,1121025,	iif(Datenum()>=1121026 and Datenum()<=1121129,1121129,	iif(Datenum()>=1121130 and Datenum()<=1121227,1121227,	iif(Datenum()>=1121228 and Datenum()<=1130131,1130131,	iif(Datenum()>=1130201 and Datenum()<=1130228,1130228,	iif(Datenum()>=1130301 and Datenum()<=1130328,1130328,	iif(Datenum()>=1130329 and Datenum()<=1130425,1130425,	iif(Datenum()>=1130426 and Datenum()<=1130530,1130530,	iif(Datenum()>=1130531 and Datenum()<=1130627,1130627,	iif(Datenum()>=1130628 and Datenum()<=1130725,1130725,	iif(Datenum()>=1130726 and Datenum()<=1130829,1130829,	iif(Datenum()>=1130830 and Datenum()<=1130926,1130926,	iif(Datenum()>=1130927 and Datenum()<=1131031,1131031,	iif(Datenum()>=1131101 and Datenum()<=1131128,1131128,	iif(Datenum()>=1131129 and Datenum()<=1131226,1131226,	iif(Datenum()>=1131227 and Datenum()<=1140130,1140130,	iif(Datenum()>=1140131 and Datenum()<=1140226,1140226,	iif(Datenum()>=1140227 and Datenum()<=1140327,1140327,	iif(Datenum()>=1140328 and Datenum()<=1140423,1140423,	iif(Datenum()>=1140424 and Datenum()<=1140529,1140529,	iif(Datenum()>=1140530 and Datenum()<=1140626,1140626,	iif(Datenum()>=1140627 and Datenum()<=1140731,1140731,	iif(Datenum()>=1140801 and Datenum()<=1140828,1140828,	iif(Datenum()>=1140829 and Datenum()<=1140925,1140925,	iif(Datenum()>=1140926 and Datenum()<=1141030,1141030,	iif(Datenum()>=1141031 and Datenum()<=1141127,1141127,	iif(Datenum()>=1141128 and Datenum()<=1141224,1141224,	iif(Datenum()>=1141225 and Datenum()<=1150129,1150129,	iif(Datenum()>=1150130 and Datenum()<=1150226,1150226,	iif(Datenum()>=1150227 and Datenum()<=1150326,1150326,	iif(Datenum()>=1150327 and Datenum()<=1150430,1150430,	iif(Datenum()>=1150501 and Datenum()<=1150528,1150528,	iif(Datenum()>=1150529 and Datenum()<=1150625,1150625,	iif(Datenum()>=1150626 and Datenum()<=1150730,1150730,	iif(Datenum()>=1150731 and Datenum()<=1150827,1150827,	iif(Datenum()>=1150828 and Datenum()<=1150924,1150924,	iif(Datenum()>=1150925 and Datenum()<=1151029,1151029,	iif(Datenum()>=1151030 and Datenum()<=1151126,1151126,	iif(Datenum()>=1151127 and Datenum()<=1151231,1151231,	iif(Datenum()>=1160101 and Datenum()<=1160128,1160128,	iif(Datenum()>=1160129 and Datenum()<=1160225,1160225,	iif(Datenum()>=1160226 and Datenum()<=1160331,1160331,	iif(Datenum()>=1160401 and Datenum()<=1160428,1160428,	iif(Datenum()>=1160429 and Datenum()<=1160526,1160526,	iif(Datenum()>=1160527 and Datenum()<=1160630,1160630,	iif(Datenum()>=1160701 and Datenum()<=1160728,1160728,	iif(Datenum()>=1160729 and Datenum()<=1160825,1160825,	iif(Datenum()>=1160826 and Datenum()<=1160929,1160929,	iif(Datenum()>=1160930 and Datenum()<=1161027,1161027,	iif(Datenum()>=1161028 and Datenum()<=1161124,1161124,	iif(Datenum()>=1161125 and Datenum()<=1161229,1161229,	iif(Datenum()>=1161230 and Datenum()<=1170125,1170125,	iif(Datenum()>=1170126 and Datenum()<=1170223,1170223,	iif(Datenum()>=1170224 and Datenum()<=1170330,1170330,	iif(Datenum()>=1170331 and Datenum()<=1170427,1170427,	iif(Datenum()>=1170428 and Datenum()<=1170525,1170525,	iif(Datenum()>=1170526 and Datenum()<=1170629,1170629,	iif(Datenum()>=1170630 and Datenum()<=1170727,1170727,	iif(Datenum()>=1170728 and Datenum()<=1170831,1170831,	iif(Datenum()>=1170901 and Datenum()<=1170928,1170928,	iif(Datenum()>=1170929 and Datenum()<=1171026,1171026,	iif(Datenum()>=1171027 and Datenum()<=1171130,1171130,	iif(Datenum()>=1171201 and Datenum()<=1171228,1171228,	iif(Datenum()>=1171229 and Datenum()<=1180125,1180125,	iif(Datenum()>=1180126 and Datenum()<=1180222,1180222,	iif(Datenum()>=1180223 and Datenum()<=1180328,1180328,	iif(Datenum()>=1180329 and Datenum()<=1180426,1180426,	iif(Datenum()>=1180427 and Datenum()<=1180531,1180531,	iif(Datenum()>=1180601 and Datenum()<=1180628,1180628,	iif(Datenum()>=1180629 and Datenum()<=1180726,1180726,	iif(Datenum()>=1180727 and Datenum()<=1180830,1180830,	iif(Datenum()>=1180831 and Datenum()<=1180927,1180927,	iif(Datenum()>=1180928 and Datenum()<=1181025,1181025,	iif(Datenum()>=1181026 and Datenum()<=1181129,1181129,	iif(Datenum()>=1181130 and Datenum()<=1181227,1181227,	iif(Datenum()>=1181228 and Datenum()<=1190131,1190131,	iif(Datenum()>=1190201 and Datenum()<=1190228,1190228,	iif(Datenum()>=1190301 and Datenum()<=1190328,1190328,	iif(Datenum()>=1190329 and Datenum()<=1190425,1190425,	iif(Datenum()>=1190426 and Datenum()<=1190530,1190530,	iif(Datenum()>=1190531 and Datenum()<=1190627,1190627,	iif(Datenum()>=1190628 and Datenum()<=1190725,1190725,	iif(Datenum()>=1190726 and Datenum()<=1190829,1190829,	iif(Datenum()>=1190830 and Datenum()<=1190926,1190926,	iif(Datenum()>=1190927 and Datenum()<=1191031,1191031,	iif(Datenum()>=1191101 and Datenum()<=1191128,1191128,	iif(Datenum()>=1191129 and Datenum()<=1191226,1191226,	iif(Datenum()>=1191227 and Datenum()<=1200130,1200130,	iif(Datenum()>=1200131 and Datenum()<=1200227,1200227,	iif(Datenum()>=1200228 and Datenum()<=1200326,1200326,	iif(Datenum()>=1200327 and Datenum()<=1200430,1200430,	iif(Datenum()>=1200501 and Datenum()<=1200528,1200528,	iif(Datenum()>=1200529 and Datenum()<=1200625,1200625,	iif(Datenum()>=1200626 and Datenum()<=1200730,1200730,	iif(Datenum()>=1200731 and Datenum()<=1200827,1200827,	iif(Datenum()>=1200828 and Datenum()<=1200924,1200924,	iif(Datenum()>=1200925 and Datenum()<=1201029,1201029,	iif(Datenum()>=1201030 and Datenum()<=1201126,1201126,	iif(Datenum()>=1201127 and Datenum()<=1201231,1201231,	iif(Datenum()>=1210101 and Datenum()<=1210128,1210128,	iif(Datenum()>=1210129 and Datenum()<=1210225,1210225,	iif(Datenum()>=1210226 and Datenum()<=1210325,1210325,	iif(Datenum()>=1210326 and Datenum()<=1210429,1210429,	iif(Datenum()>=1210430 and Datenum()<=1210527,1210527,	iif(Datenum()>=1210528 and Datenum()<=1210624,1210624,	iif(Datenum()>=1210625 and Datenum()<=1210729,1210729,	iif(Datenum()>=1210730 and Datenum()<=1210826,1210826,	iif(Datenum()>=1210827 and Datenum()<=1210930,1210930,	iif(Datenum()>=1211001 and Datenum()<=1211028,1211028,	iif(Datenum()>=1211029 and Datenum()<=1211125,1211125,	iif(Datenum()>=1211126 and Datenum()<=1211230,1211230,	iif(Datenum()>=1211231 and Datenum()<=1220127,1220127,	iif(Datenum()>=1220128 and Datenum()<=1220224,1220224,	iif(Datenum()>=1220225 and Datenum()<=1220331,1220331,	iif(Datenum()>=1220401 and Datenum()<=1220428,1220428,	iif(Datenum()>=1220429 and Datenum()<=1220526,1220526,	iif(Datenum()>=1220527 and Datenum()<=1220630,1220630,	iif(Datenum()>=1220701 and Datenum()<=1220728,1220728,	iif(Datenum()>=1220729 and Datenum()<=1220825,1220825,Iif(Datenum()>=1220826 and Datenum()<=1220929,1220929,	Iif(Datenum()>=1220930 and Datenum()<=1221027,1221027,	Iif(Datenum()>=1221028 and Datenum()<=1221124,1221124,	Iif(Datenum()>=1221125 and Datenum()<=1221229,1221229,Null)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	)	))))));
//weekly expiry dates
//wrong weekly dates//expday = Iif(Datenum()>=1160527 and Datenum()<=1160602,1160602,	Iif(Datenum()>=1160603 and Datenum()<=1160609,1160609,	Iif(Datenum()>=1160610 and Datenum()<=1160616,1160616,	Iif(Datenum()>=1160617 and Datenum()<=1160623,1160623,	Iif(Datenum()>=1160624 and Datenum()<=1160630,1160630,	Iif(Datenum()>=1160701 and Datenum()<=1160707,1160707,	Iif(Datenum()>=1160708 and Datenum()<=1160714,1160714,	Iif(Datenum()>=1160715 and Datenum()<=1160721,1160721,	Iif(Datenum()>=1160722 and Datenum()<=1160728,1160728,	Iif(Datenum()>=1160729 and Datenum()<=1160804,1160804,	Iif(Datenum()>=1160805 and Datenum()<=1160811,1160811,	Iif(Datenum()>=1160812 and Datenum()<=1160818,1160818,	Iif(Datenum()>=1160819 and Datenum()<=1160825,1160825,	Iif(Datenum()>=1160826 and Datenum()<=1160901,1160901,	Iif(Datenum()>=1160902 and Datenum()<=1160908,1160908,	Iif(Datenum()>=1160909 and Datenum()<=1160915,1160915,	Iif(Datenum()>=1160916 and Datenum()<=1160922,1160922,	Iif(Datenum()>=1160923 and Datenum()<=1160929,1160929,	Iif(Datenum()>=1160930 and Datenum()<=1161006,1161006,	Iif(Datenum()>=1161007 and Datenum()<=1161013,1161013,	Iif(Datenum()>=1161014 and Datenum()<=1161020,1161020,	Iif(Datenum()>=1161021 and Datenum()<=1161027,1161027,	Iif(Datenum()>=1161028 and Datenum()<=1161103,1161103,	Iif(Datenum()>=1161104 and Datenum()<=1161110,1161110,	Iif(Datenum()>=1161111 and Datenum()<=1161117,1161117,	Iif(Datenum()>=1161118 and Datenum()<=1161124,1161124,	Iif(Datenum()>=1161125 and Datenum()<=1161201,1161201,	Iif(Datenum()>=1161202 and Datenum()<=1161208,1161208,	Iif(Datenum()>=1161209 and Datenum()<=1161215,1161215,	Iif(Datenum()>=1161216 and Datenum()<=1161222,1161222,	Iif(Datenum()>=1161223 and Datenum()<=1161229,1161229,	Iif(Datenum()>=1161230 and Datenum()<=1170105,1170105,	Iif(Datenum()>=1170106 and Datenum()<=1170112,1170112,	Iif(Datenum()>=1170113 and Datenum()<=1170119,1170119,	Iif(Datenum()>=1170120 and Datenum()<=1170125,1170125,	Iif(Datenum()>=1170126 and Datenum()<=1170202,1170202,	Iif(Datenum()>=1170203 and Datenum()<=1170209,1170209,	Iif(Datenum()>=1170210 and Datenum()<=1170216,1170216,	Iif(Datenum()>=1170217 and Datenum()<=1170223,1170223,	Iif(Datenum()>=1170224 and Datenum()<=1170302,1170302,	Iif(Datenum()>=1170303 and Datenum()<=1170309,1170309,	Iif(Datenum()>=1170310 and Datenum()<=1170316,1170316,	Iif(Datenum()>=1170317 and Datenum()<=1170323,1170323,	Iif(Datenum()>=1170324 and Datenum()<=1170330,1170330,	Iif(Datenum()>=1170331 and Datenum()<=1170406,1170406,	Iif(Datenum()>=1170407 and Datenum()<=1170413,1170413,	Iif(Datenum()>=1170414 and Datenum()<=1170420,1170420,	Iif(Datenum()>=1170421 and Datenum()<=1170427,1170427,	Iif(Datenum()>=1170428 and Datenum()<=1170504,1170504,	Iif(Datenum()>=1170505 and Datenum()<=1170511,1170511,	Iif(Datenum()>=1170512 and Datenum()<=1170518,1170518,	Iif(Datenum()>=1170519 and Datenum()<=1170525,1170525,	Iif(Datenum()>=1170526 and Datenum()<=1170601,1170601,	Iif(Datenum()>=1170602 and Datenum()<=1170608,1170608,	Iif(Datenum()>=1170609 and Datenum()<=1170615,1170615,	Iif(Datenum()>=1170616 and Datenum()<=1170622,1170622,	Iif(Datenum()>=1170623 and Datenum()<=1170629,1170629,	Iif(Datenum()>=1170630 and Datenum()<=1170706,1170706,	Iif(Datenum()>=1170707 and Datenum()<=1170713,1170713,	Iif(Datenum()>=1170714 and Datenum()<=1170720,1170720,	Iif(Datenum()>=1170721 and Datenum()<=1170727,1170727,	Iif(Datenum()>=1170728 and Datenum()<=1170803,1170803,	Iif(Datenum()>=1170804 and Datenum()<=1170810,1170810,	Iif(Datenum()>=1170811 and Datenum()<=1170817,1170817,	Iif(Datenum()>=1170818 and Datenum()<=1170824,1170824,	Iif(Datenum()>=1170825 and Datenum()<=1170831,1170831,	Iif(Datenum()>=1170901 and Datenum()<=1170907,1170907,	Iif(Datenum()>=1170908 and Datenum()<=1170914,1170914,	Iif(Datenum()>=1170915 and Datenum()<=1170921,1170921,	Iif(Datenum()>=1170922 and Datenum()<=1170928,1170928,	Iif(Datenum()>=1170929 and Datenum()<=1171005,1171005,	Iif(Datenum()>=1171006 and Datenum()<=1171012,1171012,	Iif(Datenum()>=1171013 and Datenum()<=1171018,1171018,	Iif(Datenum()>=1171019 and Datenum()<=1171026,1171026,	Iif(Datenum()>=1171027 and Datenum()<=1171102,1171102,	Iif(Datenum()>=1171103 and Datenum()<=1171109,1171109,	Iif(Datenum()>=1171110 and Datenum()<=1171116,1171116,	Iif(Datenum()>=1171117 and Datenum()<=1171123,1171123,	Iif(Datenum()>=1171124 and Datenum()<=1171130,1171130,	Iif(Datenum()>=1171201 and Datenum()<=1171207,1171207,	Iif(Datenum()>=1171208 and Datenum()<=1171214,1171214,	Iif(Datenum()>=1171215 and Datenum()<=1171221,1171221,	Iif(Datenum()>=1171222 and Datenum()<=1171228,1171228,	Iif(Datenum()>=1171229 and Datenum()<=1180104,1180104,	Iif(Datenum()>=1180105 and Datenum()<=1180111,1180111,	Iif(Datenum()>=1180112 and Datenum()<=1180118,1180118,	Iif(Datenum()>=1180119 and Datenum()<=1180125,1180125,	Iif(Datenum()>=1180126 and Datenum()<=1180201,1180201,	Iif(Datenum()>=1180202 and Datenum()<=1180208,1180208,	Iif(Datenum()>=1180209 and Datenum()<=1180215,1180215,	Iif(Datenum()>=1180216 and Datenum()<=1180222,1180222,	Iif(Datenum()>=1180223 and Datenum()<=1180301,1180301,	Iif(Datenum()>=1180302 and Datenum()<=1180308,1180308,	Iif(Datenum()>=1180309 and Datenum()<=1180315,1180315,	Iif(Datenum()>=1180316 and Datenum()<=1180322,1180322,	Iif(Datenum()>=1180323 and Datenum()<=1180328,1180328,	Iif(Datenum()>=1180329 and Datenum()<=1180405,1180405,	Iif(Datenum()>=1180406 and Datenum()<=1180412,1180412,	Iif(Datenum()>=1180413 and Datenum()<=1180419,1180419,	Iif(Datenum()>=1180420 and Datenum()<=1180426,1180426,	Iif(Datenum()>=1180427 and Datenum()<=1180503,1180503,	Iif(Datenum()>=1180504 and Datenum()<=1180510,1180510,	Iif(Datenum()>=1180511 and Datenum()<=1180517,1180517,	Iif(Datenum()>=1180518 and Datenum()<=1180524,1180524,	Iif(Datenum()>=1180525 and Datenum()<=1180531,1180531,	Iif(Datenum()>=1180601 and Datenum()<=1180607,1180607,	Iif(Datenum()>=1180608 and Datenum()<=1180614,1180614,	Iif(Datenum()>=1180615 and Datenum()<=1180621,1180621,	Iif(Datenum()>=1180622 and Datenum()<=1180628,1180628,	Iif(Datenum()>=1180629 and Datenum()<=1180705,1180705,	Iif(Datenum()>=1180706 and Datenum()<=1180712,1180712,	Iif(Datenum()>=1180713 and Datenum()<=1180719,1180719,	Iif(Datenum()>=1180720 and Datenum()<=1180726,1180726,	Iif(Datenum()>=1180727 and Datenum()<=1180802,1180802,	Iif(Datenum()>=1180803 and Datenum()<=1180809,1180809,	Iif(Datenum()>=1180810 and Datenum()<=1180816,1180816,	Iif(Datenum()>=1180817 and Datenum()<=1180823,1180823,	Iif(Datenum()>=1180824 and Datenum()<=1180830,1180830,	Iif(Datenum()>=1180831 and Datenum()<=1180906,1180906,	Iif(Datenum()>=1180907 and Datenum()<=1180912,1180912,	Iif(Datenum()>=1180913 and Datenum()<=1180919,1180919,	Iif(Datenum()>=1180920 and Datenum()<=1180927,1180927,	Iif(Datenum()>=1180928 and Datenum()<=1181004,1181004,	Iif(Datenum()>=1181005 and Datenum()<=1181011,1181011,	Iif(Datenum()>=1181012 and Datenum()<=1181017,1181017,	Iif(Datenum()>=1181018 and Datenum()<=1181025,1181025,	Iif(Datenum()>=1181026 and Datenum()<=1181101,1181101,	Iif(Datenum()>=1181102 and Datenum()<=1181106,1181106,	Iif(Datenum()>=1181107 and Datenum()<=1181115,1181115,	Iif(Datenum()>=1181116 and Datenum()<=1181122,1181122,	Iif(Datenum()>=1181123 and Datenum()<=1181129,1181129,	Iif(Datenum()>=1181130 and Datenum()<=1181206,1181206,	Iif(Datenum()>=1181207 and Datenum()<=1181213,1181213,	Iif(Datenum()>=1181214 and Datenum()<=1181220,1181220,	Iif(Datenum()>=1181221 and Datenum()<=1181227,1181227,	Iif(Datenum()>=1181228 and Datenum()<=1190103,1190103,	Iif(Datenum()>=1190104 and Datenum()<=1190110,1190110,	Iif(Datenum()>=1190111 and Datenum()<=1190117,1190117,	Iif(Datenum()>=1190118 and Datenum()<=1190124,1190124,	Iif(Datenum()>=1190125 and Datenum()<=1190131,1190131,	Iif(Datenum()>=1190201 and Datenum()<=1190207,1190207,	Iif(Datenum()>=1190208 and Datenum()<=1190214,1190214,	Iif(Datenum()>=1190215 and Datenum()<=1190221,1190221,	Iif(Datenum()>=1190222 and Datenum()<=1190228,1190228,	Iif(Datenum()>=1190301 and Datenum()<=1190307,1190307,	Iif(Datenum()>=1190308 and Datenum()<=1190314,1190314,	Iif(Datenum()>=1190315 and Datenum()<=1190320,1190320,	Iif(Datenum()>=1190321 and Datenum()<=1190328,1190328,	Iif(Datenum()>=1190329 and Datenum()<=1190404,1190404,	Iif(Datenum()>=1190405 and Datenum()<=1190411,1190411,	Iif(Datenum()>=1190412 and Datenum()<=1190418,1190418,	Iif(Datenum()>=1190419 and Datenum()<=1190425,1190425,	Iif(Datenum()>=1190426 and Datenum()<=1190502,1190502,	Iif(Datenum()>=1190503 and Datenum()<=1190509,1190509,	Iif(Datenum()>=1190510 and Datenum()<=1190516,1190516,	Iif(Datenum()>=1190517 and Datenum()<=1190523,1190523,	Iif(Datenum()>=1190524 and Datenum()<=1190530,1190530,	Iif(Datenum()>=1190531 and Datenum()<=1190606,1190606,	Iif(Datenum()>=1190607 and Datenum()<=1190613,1190613,	Iif(Datenum()>=1190614 and Datenum()<=1190620,1190620,	Iif(Datenum()>=1190621 and Datenum()<=1190627,1190627,	Iif(Datenum()>=1190628 and Datenum()<=1190704,1190704,	Iif(Datenum()>=1190705 and Datenum()<=1190711,1190711,	Iif(Datenum()>=1190712 and Datenum()<=1190718,1190718,	Iif(Datenum()>=1190719 and Datenum()<=1190725,1190725,	Iif(Datenum()>=1190726 and Datenum()<=1190801,1190801,	Iif(Datenum()>=1190802 and Datenum()<=1190808,1190808,	Iif(Datenum()>=1190809 and Datenum()<=1190814,1190814,	Iif(Datenum()>=1190815 and Datenum()<=1190822,1190822,	Iif(Datenum()>=1190823 and Datenum()<=1190829,1190829,	Iif(Datenum()>=1190830 and Datenum()<=1190905,1190905,	Iif(Datenum()>=1190906 and Datenum()<=1190912,1190912,	Iif(Datenum()>=1190913 and Datenum()<=1190919,1190919,	Iif(Datenum()>=1190920 and Datenum()<=1190926,1190926,	Iif(Datenum()>=1190927 and Datenum()<=1191003,1191003,	Iif(Datenum()>=1191004 and Datenum()<=1191010,1191010,	Iif(Datenum()>=1191011 and Datenum()<=1191017,1191017,	Iif(Datenum()>=1191018 and Datenum()<=1191024,1191024,	Iif(Datenum()>=1191025 and Datenum()<=1191031,1191031,	Iif(Datenum()>=1191101 and Datenum()<=1191107,1191107,	Iif(Datenum()>=1191108 and Datenum()<=1191114,1191114,	Iif(Datenum()>=1191115 and Datenum()<=1191121,1191121,	Iif(Datenum()>=1191122 and Datenum()<=1191128,1191128,	Iif(Datenum()>=1191129 and Datenum()<=1191205,1191205,	Iif(Datenum()>=1191206 and Datenum()<=1191212,1191212,	Iif(Datenum()>=1191213 and Datenum()<=1191219,1191219,	Iif(Datenum()>=1191220 and Datenum()<=1191226,1191226,	Iif(Datenum()>=1191227 and Datenum()<=1200102,1200102,	Iif(Datenum()>=1200103 and Datenum()<=1200109,1200109,	Iif(Datenum()>=1200110 and Datenum()<=1200116,1200116,	Iif(Datenum()>=1200117 and Datenum()<=1200123,1200123,	Iif(Datenum()>=1200124 and Datenum()<=1200130,1200130,	Iif(Datenum()>=1200131 and Datenum()<=1200206,1200206,	Iif(Datenum()>=1200207 and Datenum()<=1200213,1200213,	Iif(Datenum()>=1200214 and Datenum()<=1200220,1200220,	Iif(Datenum()>=1200221 and Datenum()<=1200227,1200227,	Iif(Datenum()>=1200228 and Datenum()<=1200305,1200305,	Iif(Datenum()>=1200306 and Datenum()<=1200312,1200312,	Iif(Datenum()>=1200313 and Datenum()<=1200319,1200319,	Iif(Datenum()>=1200320 and Datenum()<=1200326,1200326,	Iif(Datenum()>=1200327 and Datenum()<=1200401,1200401,	Iif(Datenum()>=1200402 and Datenum()<=1200409,1200409,	Iif(Datenum()>=1200410 and Datenum()<=1200416,1200416,	Iif(Datenum()>=1200417 and Datenum()<=1200423,1200423,	Iif(Datenum()>=1200424 and Datenum()<=1200430,1200430,	Iif(Datenum()>=1200501 and Datenum()<=1200507,1200507,	Iif(Datenum()>=1200508 and Datenum()<=1200514,1200514,	Iif(Datenum()>=1200515 and Datenum()<=1200521,1200521,	Iif(Datenum()>=1200522 and Datenum()<=1200528,1200528,	Iif(Datenum()>=1200529 and Datenum()<=1200604,1200604,	Iif(Datenum()>=1200605 and Datenum()<=1200611,1200611,	Iif(Datenum()>=1200612 and Datenum()<=1200618,1200618,	Iif(Datenum()>=1200619 and Datenum()<=1200625,1200625,	Iif(Datenum()>=1200626 and Datenum()<=1200702,1200702,	Iif(Datenum()>=1200703 and Datenum()<=1200709,1200709,	Iif(Datenum()>=1200710 and Datenum()<=1200716,1200716,	Iif(Datenum()>=1200717 and Datenum()<=1200723,1200723,	Iif(Datenum()>=1200724 and Datenum()<=1200730,1200730,	Iif(Datenum()>=1200731 and Datenum()<=1200806,1200806,	Iif(Datenum()>=1200807 and Datenum()<=1200813,1200813,	Iif(Datenum()>=1200814 and Datenum()<=1200820,1200820,	Iif(Datenum()>=1200821 and Datenum()<=1200827,1200827,	Iif(Datenum()>=1200828 and Datenum()<=1200903,1200903,	Iif(Datenum()>=1200904 and Datenum()<=1200910,1200910,	Iif(Datenum()>=1200911 and Datenum()<=1200917,1200917,	Iif(Datenum()>=1200918 and Datenum()<=1200924,1200924,	Iif(Datenum()>=1200925 and Datenum()<=1201001,1201001,	Iif(Datenum()>=1201002 and Datenum()<=1201008,1201008,	Iif(Datenum()>=1201009 and Datenum()<=1201015,1201015,	Iif(Datenum()>=1201016 and Datenum()<=1201022,1201022,	Iif(Datenum()>=1201023 and Datenum()<=1201029,1201029,	Iif(Datenum()>=1201030 and Datenum()<=1201105,1201105,	Iif(Datenum()>=1201106 and Datenum()<=1201112,1201112,	Iif(Datenum()>=1201113 and Datenum()<=1201119,1201119,	Iif(Datenum()>=1201120 and Datenum()<=1201126,1201126,	Iif(Datenum()>=1201127 and Datenum()<=1201203,1201203,	Iif(Datenum()>=1201204 and Datenum()<=1201210,1201210,	Iif(Datenum()>=1201211 and Datenum()<=1201217,1201217,	Iif(Datenum()>=1201218 and Datenum()<=1201224,1201224,	Iif(Datenum()>=1201225 and Datenum()<=1201231,1201231,	Iif(Datenum()>=1210101 and Datenum()<=1210107,1210107,	Iif(Datenum()>=1210108 and Datenum()<=1210114,1210114,	Iif(Datenum()>=1210115 and Datenum()<=1210121,1210121,	Iif(Datenum()>=1210122 and Datenum()<=1210128,1210128,	Iif(Datenum()>=1210129 and Datenum()<=1210204,1210204,	Iif(Datenum()>=1210205 and Datenum()<=1210211,1210211,	Iif(Datenum()>=1210212 and Datenum()<=1210218,1210218,	Iif(Datenum()>=1210219 and Datenum()<=1210225,1210225,	Iif(Datenum()>=1210226 and Datenum()<=1210304,1210304,	Iif(Datenum()>=1210305 and Datenum()<=1210310,1210310,	Iif(Datenum()>=1210311 and Datenum()<=1210318,1210318,	Iif(Datenum()>=1210319 and Datenum()<=1210325,1210325,	Iif(Datenum()>=1210326 and Datenum()<=1210401,1210401,	Iif(Datenum()>=1210402 and Datenum()<=1210408,1210408,	Iif(Datenum()>=1210409 and Datenum()<=1210415,1210415,	Iif(Datenum()>=1210416 and Datenum()<=1210422,1210422,	Iif(Datenum()>=1210423 and Datenum()<=1210429,1210429,	Iif(Datenum()>=1210430 and Datenum()<=1210506,1210506,	Iif(Datenum()>=1210507 and Datenum()<=1210512,1210512,	Iif(Datenum()>=1210513 and Datenum()<=1210520,1210520,	Iif(Datenum()>=1210521 and Datenum()<=1210527,1210527,	Iif(Datenum()>=1210528 and Datenum()<=1210603,1210603,	Iif(Datenum()>=1210604 and Datenum()<=1210610,1210610,	Iif(Datenum()>=1210611 and Datenum()<=1210617,1210617,	Iif(Datenum()>=1210618 and Datenum()<=1210624,1210624,	Iif(Datenum()>=1210625 and Datenum()<=1210701,1210701,	Iif(Datenum()>=1210702 and Datenum()<=1210708,1210708,	Iif(Datenum()>=1210709 and Datenum()<=1210715,1210715,	Iif(Datenum()>=1210716 and Datenum()<=1210722,1210722,	Iif(Datenum()>=1210723 and Datenum()<=1210729,1210729,	Iif(Datenum()>=1210730 and Datenum()<=1210805,1210805,	Iif(Datenum()>=1210806 and Datenum()<=1210812,1210812,	Iif(Datenum()>=1210813 and Datenum()<=1210819,1210819,	Iif(Datenum()>=1210820 and Datenum()<=1210826,1210826,	Iif(Datenum()>=1210827 and Datenum()<=1210902,1210902,	Iif(Datenum()>=1210903 and Datenum()<=1210909,1210909,	Iif(Datenum()>=1210910 and Datenum()<=1210916,1210916,	Iif(Datenum()>=1210917 and Datenum()<=1210923,1210923,	Iif(Datenum()>=1210924 and Datenum()<=1210930,1210930,	Iif(Datenum()>=1211001 and Datenum()<=1211007,1211007,	Iif(Datenum()>=1211008 and Datenum()<=1211014,1211014,	Iif(Datenum()>=1211015 and Datenum()<=1211021,1211021,	Iif(Datenum()>=1211022 and Datenum()<=1211028,1211028,	Iif(Datenum()>=1211029 and Datenum()<=1211104,1211104,	Iif(Datenum()>=1211105 and Datenum()<=1211111,1211111,	Iif(Datenum()>=1211112 and Datenum()<=1211118,1211118,	Iif(Datenum()>=1211119 and Datenum()<=1211125,1211125,	Iif(Datenum()>=1211126 and Datenum()<=1211202,1211202,	Iif(Datenum()>=1211203 and Datenum()<=1211209,1211209,	Iif(Datenum()>=1211210 and Datenum()<=1211216,1211216,	Iif(Datenum()>=1211217 and Datenum()<=1211223,1211223,	Iif(Datenum()>=1211224 and Datenum()<=1211230,1211230,	Iif(Datenum()>=1211231 and Datenum()<=1220106,1220106,	Iif(Datenum()>=1220107 and Datenum()<=1220113,1220113,	Iif(Datenum()>=1220114 and Datenum()<=1220120,1220120,	Iif(Datenum()>=1220121 and Datenum()<=1220127,1220127,	Iif(Datenum()>=1220128 and Datenum()<=1220203,1220203,	Iif(Datenum()>=1220204 and Datenum()<=1220210,1220210,	Iif(Datenum()>=1220211 and Datenum()<=1220217,1220217,	Iif(Datenum()>=1220218 and Datenum()<=1220224,1220224,	Iif(Datenum()>=1220225 and Datenum()<=1220303,1220303,	Iif(Datenum()>=1220304 and Datenum()<=1220310,1220310,	Iif(Datenum()>=1220311 and Datenum()<=1220317,1220317,	Iif(Datenum()>=1220318 and Datenum()<=1220324,1220324,	Iif(Datenum()>=1220325 and Datenum()<=1220331,1220331,	Iif(Datenum()>=1220401 and Datenum()<=1220407,1220407,	Iif(Datenum()>=1220408 and Datenum()<=1220413,1220413,	Iif(Datenum()>=1220414 and Datenum()<=1220421,1220421,	Iif(Datenum()>=1220422 and Datenum()<=1220428,1220428,	Iif(Datenum()>=1220429 and Datenum()<=1220505,1220505,	Iif(Datenum()>=1220506 and Datenum()<=1220512,1220512,	Iif(Datenum()>=1220513 and Datenum()<=1220519,1220519,	Iif(Datenum()>=1220520 and Datenum()<=1220526,1220526,	Iif(Datenum()>=1220527 and Datenum()<=1220602,1220602,	Iif(Datenum()>=1220603 and Datenum()<=1220609,1220609,	Iif(Datenum()>=1220610 and Datenum()<=1220616,1220616,	Iif(Datenum()>=1220617 and Datenum()<=1220623,1220623,	Iif(Datenum()>=1220624 and Datenum()<=1220630,1220630,	Iif(Datenum()>=1220701 and Datenum()<=1220707,1220707,	Iif(Datenum()>=1220708 and Datenum()<=1220714,1220714,	Iif(Datenum()>=1220715 and Datenum()<=1220721,1220721,	Iif(Datenum()>=1220722 and Datenum()<=1220728,1220728,	Iif(Datenum()>=1220729 and Datenum()<=1220804,1220804,	Iif(Datenum()>=1220805 and Datenum()<=1220811,1220811,	Iif(Datenum()>=1220812 and Datenum()<=1220818,1220818,	Iif(Datenum()>=1220819 and Datenum()<=1220825,1220825,	Iif(Datenum()>=1220826 and Datenum()<=1220901,1220901,	Iif(Datenum()>=1220902 and Datenum()<=1220908,1220908,	Iif(Datenum()>=1220909 and Datenum()<=1220915,1220915,	Iif(Datenum()>=1220916 and Datenum()<=1220922,1220922,	Iif(Datenum()>=1220923 and Datenum()<=1220929,1220929,	Iif(Datenum()>=1220930 and Datenum()<=1221006,1221006,	Iif(Datenum()>=1221007 and Datenum()<=1221013,1221013,	Iif(Datenum()>=1221014 and Datenum()<=1221020,1221020,	Iif(Datenum()>=1221021 and Datenum()<=1221027,1221027,	Iif(Datenum()>=1221028 and Datenum()<=1221103,1221103,	Iif(Datenum()>=1221104 and Datenum()<=1221110,1221110,	Iif(Datenum()>=1221111 and Datenum()<=1221117,1221117,	Iif(Datenum()>=1221118 and Datenum()<=1221124,1221124,	Iif(Datenum()>=1221125 and Datenum()<=1221201,1221201,	Iif(Datenum()>=1221202 and Datenum()<=1221208,1221208,	Iif(Datenum()>=1221209 and Datenum()<=1221215,1221215,	Iif(Datenum()>=1221216 and Datenum()<=1221222,1221222,	Iif(Datenum()>=1221223 and Datenum()<=1221229,1221229,	Iif(Datenum()>=1221230 and Datenum()<=1230105,1230105,	Iif(Datenum()>=1230106 and Datenum()<=1230112,1230112,	Iif(Datenum()>=1230113 and Datenum()<=1230119,1230119,	Iif(Datenum()>=1230120 and Datenum()<=1230125,1230125,	Iif(Datenum()>=1230126 and Datenum()<=1230202,1230202,	Iif(Datenum()>=1230203 and Datenum()<=1230209,1230209,	Iif(Datenum()>=1230210 and Datenum()<=1230216,1230216,	Iif(Datenum()>=1230217 and Datenum()<=1230223,1230223,Null))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))));
//expday = Iif(Datenum()>=1160527 and Datenum()<=1160602,1160602,	Iif(Datenum()>=1160603 and Datenum()<=1160609,1160609,	Iif(Datenum()>=1160610 and Datenum()<=1160616,1160616,	Iif(Datenum()>=1160617 and Datenum()<=1160623,1160623,	Iif(Datenum()>=1160624 and Datenum()<=1160630,1160630,	Iif(Datenum()>=1160701 and Datenum()<=1160707,1160707,	Iif(Datenum()>=1160708 and Datenum()<=1160714,1160714,	Iif(Datenum()>=1160715 and Datenum()<=1160721,1160721,	Iif(Datenum()>=1160722 and Datenum()<=1160728,1160728,	Iif(Datenum()>=1160729 and Datenum()<=1160804,1160804,	Iif(Datenum()>=1160805 and Datenum()<=1160811,1160811,	Iif(Datenum()>=1160812 and Datenum()<=1160818,1160818,	Iif(Datenum()>=1160819 and Datenum()<=1160825,1160825,	Iif(Datenum()>=1160826 and Datenum()<=1160901,1160901,	Iif(Datenum()>=1160902 and Datenum()<=1160908,1160908,	Iif(Datenum()>=1160909 and Datenum()<=1160915,1160915,	Iif(Datenum()>=1160916 and Datenum()<=1160922,1160922,	Iif(Datenum()>=1160923 and Datenum()<=1160929,1160929,	Iif(Datenum()>=1160930 and Datenum()<=1161006,1161006,	Iif(Datenum()>=1161007 and Datenum()<=1161013,1161013,	Iif(Datenum()>=1161014 and Datenum()<=1161020,1161020,	Iif(Datenum()>=1161021 and Datenum()<=1161027,1161027,	Iif(Datenum()>=1161028 and Datenum()<=1161103,1161103,	Iif(Datenum()>=1161104 and Datenum()<=1161110,1161110,	Iif(Datenum()>=1161111 and Datenum()<=1161117,1161117,	Iif(Datenum()>=1161118 and Datenum()<=1161124,1161124,	Iif(Datenum()>=1161125 and Datenum()<=1161201,1161201,	Iif(Datenum()>=1161202 and Datenum()<=1161208,1161208,	Iif(Datenum()>=1161209 and Datenum()<=1161215,1161215,	Iif(Datenum()>=1161216 and Datenum()<=1161222,1161222,	Iif(Datenum()>=1161223 and Datenum()<=1161229,1161229,	Iif(Datenum()>=1161230 and Datenum()<=1170105,1170105,	Iif(Datenum()>=1170106 and Datenum()<=1170112,1170112,	Iif(Datenum()>=1170113 and Datenum()<=1170119,1170119,	Iif(Datenum()>=1170120 and Datenum()<=1170125,1170125,	Iif(Datenum()>=1170126 and Datenum()<=1170202,1170202,	Iif(Datenum()>=1170203 and Datenum()<=1170209,1170209,	Iif(Datenum()>=1170210 and Datenum()<=1170216,1170216,	Iif(Datenum()>=1170217 and Datenum()<=1170223,1170223,	Iif(Datenum()>=1170224 and Datenum()<=1170302,1170302,	Iif(Datenum()>=1170303 and Datenum()<=1170309,1170309,	Iif(Datenum()>=1170310 and Datenum()<=1170316,1170316,	Iif(Datenum()>=1170317 and Datenum()<=1170323,1170323,	Iif(Datenum()>=1170324 and Datenum()<=1170330,1170330,	Iif(Datenum()>=1170331 and Datenum()<=1170406,1170406,	Iif(Datenum()>=1170407 and Datenum()<=1170413,1170413,	Iif(Datenum()>=1170414 and Datenum()<=1170420,1170420,	Iif(Datenum()>=1170421 and Datenum()<=1170427,1170427,	Iif(Datenum()>=1170428 and Datenum()<=1170504,1170504,	Iif(Datenum()>=1170505 and Datenum()<=1170511,1170511,	Iif(Datenum()>=1170512 and Datenum()<=1170518,1170518,	Iif(Datenum()>=1170519 and Datenum()<=1170525,1170525,	Iif(Datenum()>=1170526 and Datenum()<=1170601,1170601,	Iif(Datenum()>=1170602 and Datenum()<=1170608,1170608,	Iif(Datenum()>=1170609 and Datenum()<=1170615,1170615,	Iif(Datenum()>=1170616 and Datenum()<=1170622,1170622,	Iif(Datenum()>=1170623 and Datenum()<=1170629,1170629,	Iif(Datenum()>=1170630 and Datenum()<=1170706,1170706,	Iif(Datenum()>=1170707 and Datenum()<=1170713,1170713,	Iif(Datenum()>=1170714 and Datenum()<=1170720,1170720,	Iif(Datenum()>=1170721 and Datenum()<=1170727,1170727,	Iif(Datenum()>=1170728 and Datenum()<=1170803,1170803,	Iif(Datenum()>=1170804 and Datenum()<=1170810,1170810,	Iif(Datenum()>=1170811 and Datenum()<=1170817,1170817,	Iif(Datenum()>=1170818 and Datenum()<=1170824,1170824,	Iif(Datenum()>=1170825 and Datenum()<=1170831,1170831,	Iif(Datenum()>=1170901 and Datenum()<=1170907,1170907,	Iif(Datenum()>=1170908 and Datenum()<=1170914,1170914,	Iif(Datenum()>=1170915 and Datenum()<=1170921,1170921,	Iif(Datenum()>=1170922 and Datenum()<=1170928,1170928,	Iif(Datenum()>=1170929 and Datenum()<=1171005,1171005,	Iif(Datenum()>=1171006 and Datenum()<=1171012,1171012,	Iif(Datenum()>=1171013 and Datenum()<=1171018,1171018,	Iif(Datenum()>=1171019 and Datenum()<=1171026,1171026,	Iif(Datenum()>=1171027 and Datenum()<=1171102,1171102,	Iif(Datenum()>=1171103 and Datenum()<=1171109,1171109,	Iif(Datenum()>=1171110 and Datenum()<=1171116,1171116,	Iif(Datenum()>=1171117 and Datenum()<=1171123,1171123,	Iif(Datenum()>=1171124 and Datenum()<=1171130,1171130,	Iif(Datenum()>=1171201 and Datenum()<=1171207,1171207,	Iif(Datenum()>=1171208 and Datenum()<=1171214,1171214,	Iif(Datenum()>=1171215 and Datenum()<=1171221,1171221,	Iif(Datenum()>=1171222 and Datenum()<=1171228,1171228,	Iif(Datenum()>=1171229 and Datenum()<=1180104,1180104,	Iif(Datenum()>=1180105 and Datenum()<=1180111,1180111,	Iif(Datenum()>=1180112 and Datenum()<=1180118,1180118,	Iif(Datenum()>=1180119 and Datenum()<=1180125,1180125,	Iif(Datenum()>=1180126 and Datenum()<=1180201,1180201,	Iif(Datenum()>=1180202 and Datenum()<=1180208,1180208,	Iif(Datenum()>=1180209 and Datenum()<=1180215,1180215,	Iif(Datenum()>=1180216 and Datenum()<=1180222,1180222,	Iif(Datenum()>=1180223 and Datenum()<=1180301,1180301,	Iif(Datenum()>=1180302 and Datenum()<=1180308,1180308,	Iif(Datenum()>=1180309 and Datenum()<=1180315,1180315,	Iif(Datenum()>=1180316 and Datenum()<=1180322,1180322,	Iif(Datenum()>=1180323 and Datenum()<=1180328,1180328,	Iif(Datenum()>=1180329 and Datenum()<=1180405,1180405,	Iif(Datenum()>=1180406 and Datenum()<=1180412,1180412,	Iif(Datenum()>=1180413 and Datenum()<=1180419,1180419,	Iif(Datenum()>=1180420 and Datenum()<=1180426,1180426,	Iif(Datenum()>=1180427 and Datenum()<=1180503,1180503,	Iif(Datenum()>=1180504 and Datenum()<=1180510,1180510,	Iif(Datenum()>=1180511 and Datenum()<=1180517,1180517,	Iif(Datenum()>=1180518 and Datenum()<=1180524,1180524,	Iif(Datenum()>=1180525 and Datenum()<=1180531,1180531,	Iif(Datenum()>=1180601 and Datenum()<=1180607,1180607,	Iif(Datenum()>=1180608 and Datenum()<=1180614,1180614,	Iif(Datenum()>=1180615 and Datenum()<=1180621,1180621,	Iif(Datenum()>=1180622 and Datenum()<=1180628,1180628,	Iif(Datenum()>=1180629 and Datenum()<=1180705,1180705,	Iif(Datenum()>=1180706 and Datenum()<=1180712,1180712,	Iif(Datenum()>=1180713 and Datenum()<=1180719,1180719,	Iif(Datenum()>=1180720 and Datenum()<=1180726,1180726,	Iif(Datenum()>=1180727 and Datenum()<=1180802,1180802,	Iif(Datenum()>=1180803 and Datenum()<=1180809,1180809,	Iif(Datenum()>=1180810 and Datenum()<=1180816,1180816,	Iif(Datenum()>=1180817 and Datenum()<=1180823,1180823,	Iif(Datenum()>=1180824 and Datenum()<=1180830,1180830,	Iif(Datenum()>=1180831 and Datenum()<=1180906,1180906,	Iif(Datenum()>=1180907 and Datenum()<=1180912,1180912,	Iif(Datenum()>=1180913 and Datenum()<=1180919,1180919,	Iif(Datenum()>=1180920 and Datenum()<=1180927,1180927,	Iif(Datenum()>=1180928 and Datenum()<=1181004,1181004,	Iif(Datenum()>=1181005 and Datenum()<=1181011,1181011,	Iif(Datenum()>=1181012 and Datenum()<=1181017,1181017,	Iif(Datenum()>=1181018 and Datenum()<=1181025,1181025,	Iif(Datenum()>=1181026 and Datenum()<=1181101,1181101,	Iif(Datenum()>=1181102 and Datenum()<=1181106,1181106,	Iif(Datenum()>=1181107 and Datenum()<=1181115,1181115,	Iif(Datenum()>=1181116 and Datenum()<=1181122,1181122,	Iif(Datenum()>=1181123 and Datenum()<=1181129,1181129,	Iif(Datenum()>=1181130 and Datenum()<=1181206,1181206,	Iif(Datenum()>=1181207 and Datenum()<=1181213,1181213,	Iif(Datenum()>=1181214 and Datenum()<=1181220,1181220,	Iif(Datenum()>=1181221 and Datenum()<=1181227,1181227,	Iif(Datenum()>=1181228 and Datenum()<=1190103,1190103,	Iif(Datenum()>=1190104 and Datenum()<=1190110,1190110,	Iif(Datenum()>=1190111 and Datenum()<=1190117,1190117,	Iif(Datenum()>=1190118 and Datenum()<=1190124,1190124,	Iif(Datenum()>=1190125 and Datenum()<=1190131,1190131,	Iif(Datenum()>=1190201 and Datenum()<=1190207,1190207,	Iif(Datenum()>=1190208 and Datenum()<=1190214,1190214,	Iif(Datenum()>=1190215 and Datenum()<=1190221,1190221,	Iif(Datenum()>=1190222 and Datenum()<=1190228,1190228,	Iif(Datenum()>=1190301 and Datenum()<=1190307,1190307,	Iif(Datenum()>=1190308 and Datenum()<=1190314,1190314,	Iif(Datenum()>=1190315 and Datenum()<=1190320,1190320,	Iif(Datenum()>=1190321 and Datenum()<=1190328,1190328,	Iif(Datenum()>=1190329 and Datenum()<=1190404,1190404,	Iif(Datenum()>=1190405 and Datenum()<=1190411,1190411,	Iif(Datenum()>=1190412 and Datenum()<=1190418,1190418,	Iif(Datenum()>=1190419 and Datenum()<=1190425,1190425,	Iif(Datenum()>=1190426 and Datenum()<=1190502,1190502,	Iif(Datenum()>=1190503 and Datenum()<=1190509,1190509,	Iif(Datenum()>=1190510 and Datenum()<=1190516,1190516,	Iif(Datenum()>=1190517 and Datenum()<=1190523,1190523,	Iif(Datenum()>=1190524 and Datenum()<=1190530,1190530,	Iif(Datenum()>=1190531 and Datenum()<=1190606,1190606,	Iif(Datenum()>=1190607 and Datenum()<=1190613,1190613,	Iif(Datenum()>=1190614 and Datenum()<=1190620,1190620,	Iif(Datenum()>=1190621 and Datenum()<=1190627,1190627,	Iif(Datenum()>=1190628 and Datenum()<=1190704,1190704,	Iif(Datenum()>=1190705 and Datenum()<=1190711,1190711,	Iif(Datenum()>=1190712 and Datenum()<=1190718,1190718,	Iif(Datenum()>=1190719 and Datenum()<=1190725,1190725,	Iif(Datenum()>=1190726 and Datenum()<=1190801,1190801,	Iif(Datenum()>=1190802 and Datenum()<=1190808,1190808,	Iif(Datenum()>=1190809 and Datenum()<=1190814,1190814,	Iif(Datenum()>=1190815 and Datenum()<=1190822,1190822,	Iif(Datenum()>=1190823 and Datenum()<=1190829,1190829,	Iif(Datenum()>=1190830 and Datenum()<=1190905,1190905,	Iif(Datenum()>=1190906 and Datenum()<=1190912,1190912,	Iif(Datenum()>=1190913 and Datenum()<=1190919,1190919,	Iif(Datenum()>=1190920 and Datenum()<=1190926,1190926,	Iif(Datenum()>=1190927 and Datenum()<=1191003,1191003,	Iif(Datenum()>=1191004 and Datenum()<=1191010,1191010,	Iif(Datenum()>=1191011 and Datenum()<=1191017,1191017,	Iif(Datenum()>=1191018 and Datenum()<=1191024,1191024,	Iif(Datenum()>=1191025 and Datenum()<=1191031,1191031,	Iif(Datenum()>=1191101 and Datenum()<=1191107,1191107,	Iif(Datenum()>=1191108 and Datenum()<=1191114,1191114,	Iif(Datenum()>=1191115 and Datenum()<=1191121,1191121,	Iif(Datenum()>=1191122 and Datenum()<=1191128,1191128,	Iif(Datenum()>=1191129 and Datenum()<=1191205,1191205,	Iif(Datenum()>=1191206 and Datenum()<=1191212,1191212,	Iif(Datenum()>=1191213 and Datenum()<=1191219,1191219,	Iif(Datenum()>=1191220 and Datenum()<=1191226,1191226,	Iif(Datenum()>=1191227 and Datenum()<=1200102,1200102,	Iif(Datenum()>=1200103 and Datenum()<=1200109,1200109,	Iif(Datenum()>=1200110 and Datenum()<=1200116,1200116,	Iif(Datenum()>=1200117 and Datenum()<=1200123,1200123,	Iif(Datenum()>=1200124 and Datenum()<=1200130,1200130,	Iif(Datenum()>=1200131 and Datenum()<=1200206,1200206,	Iif(Datenum()>=1200207 and Datenum()<=1200213,1200213,	Iif(Datenum()>=1200214 and Datenum()<=1200220,1200220,	Iif(Datenum()>=1200221 and Datenum()<=1200227,1200227,	Iif(Datenum()>=1200228 and Datenum()<=1200305,1200305,	Iif(Datenum()>=1200306 and Datenum()<=1200312,1200312,	Iif(Datenum()>=1200313 and Datenum()<=1200319,1200319,	Iif(Datenum()>=1200320 and Datenum()<=1200326,1200326,	Iif(Datenum()>=1200327 and Datenum()<=1200401,1200401,	Iif(Datenum()>=1200402 and Datenum()<=1200409,1200409,	Iif(Datenum()>=1200410 and Datenum()<=1200416,1200416,	Iif(Datenum()>=1200417 and Datenum()<=1200423,1200423,	Iif(Datenum()>=1200424 and Datenum()<=1200430,1200430,	Iif(Datenum()>=1200501 and Datenum()<=1200507,1200507,	Iif(Datenum()>=1200508 and Datenum()<=1200514,1200514,	Iif(Datenum()>=1200515 and Datenum()<=1200521,1200521,	Iif(Datenum()>=1200522 and Datenum()<=1200528,1200528,	Iif(Datenum()>=1200529 and Datenum()<=1200604,1200604,	Iif(Datenum()>=1200605 and Datenum()<=1200611,1200611,	Iif(Datenum()>=1200612 and Datenum()<=1200618,1200618,	Iif(Datenum()>=1200619 and Datenum()<=1200625,1200625,	Iif(Datenum()>=1200626 and Datenum()<=1200702,1200702,	Iif(Datenum()>=1200703 and Datenum()<=1200709,1200709,	Iif(Datenum()>=1200710 and Datenum()<=1200716,1200716,	Iif(Datenum()>=1200717 and Datenum()<=1200723,1200723,	Iif(Datenum()>=1200724 and Datenum()<=1200730,1200730,	Iif(Datenum()>=1200731 and Datenum()<=1200806,1200806,	Iif(Datenum()>=1200807 and Datenum()<=1200813,1200813,	Iif(Datenum()>=1200814 and Datenum()<=1200820,1200820,	Iif(Datenum()>=1200821 and Datenum()<=1200827,1200827,	Iif(Datenum()>=1200828 and Datenum()<=1200903,1200903,	Iif(Datenum()>=1200904 and Datenum()<=1200910,1200910,	Iif(Datenum()>=1200911 and Datenum()<=1200917,1200917,	Iif(Datenum()>=1200918 and Datenum()<=1200924,1200924,	Iif(Datenum()>=1200925 and Datenum()<=1201001,1201001,	Iif(Datenum()>=1201002 and Datenum()<=1201008,1201008,	Iif(Datenum()>=1201009 and Datenum()<=1201015,1201015,	Iif(Datenum()>=1201016 and Datenum()<=1201022,1201022,	Iif(Datenum()>=1201023 and Datenum()<=1201029,1201029,	Iif(Datenum()>=1201030 and Datenum()<=1201105,1201105,	Iif(Datenum()>=1201106 and Datenum()<=1201112,1201112,	Iif(Datenum()>=1201113 and Datenum()<=1201119,1201119,	Iif(Datenum()>=1201120 and Datenum()<=1201126,1201126,	Iif(Datenum()>=1201127 and Datenum()<=1201203,1201203,	Iif(Datenum()>=1201204 and Datenum()<=1201210,1201210,	Iif(Datenum()>=1201211 and Datenum()<=1201217,1201217,	Iif(Datenum()>=1201218 and Datenum()<=1201224,1201224,	Iif(Datenum()>=1201225 and Datenum()<=1201231,1201231,	Iif(Datenum()>=1210101 and Datenum()<=1210107,1210107,	Iif(Datenum()>=1210108 and Datenum()<=1210114,1210114,	Iif(Datenum()>=1210115 and Datenum()<=1210121,1210121,	Iif(Datenum()>=1210122 and Datenum()<=1210128,1210128,	Iif(Datenum()>=1210129 and Datenum()<=1210204,1210204,	Iif(Datenum()>=1210205 and Datenum()<=1210211,1210211,	Iif(Datenum()>=1210212 and Datenum()<=1210218,1210218,	Iif(Datenum()>=1210219 and Datenum()<=1210225,1210225,	Iif(Datenum()>=1210226 and Datenum()<=1210304,1210304,	Iif(Datenum()>=1210305 and Datenum()<=1210310,1210310,	Iif(Datenum()>=1210311 and Datenum()<=1210318,1210318,	Iif(Datenum()>=1210319 and Datenum()<=1210325,1210325,	Iif(Datenum()>=1210326 and Datenum()<=1210401,1210401,	Iif(Datenum()>=1210402 and Datenum()<=1210408,1210408,	Iif(Datenum()>=1210409 and Datenum()<=1210415,1210415,	Iif(Datenum()>=1210416 and Datenum()<=1210422,1210422,	Iif(Datenum()>=1210423 and Datenum()<=1210429,1210429,	Iif(Datenum()>=1210430 and Datenum()<=1210506,1210506,	Iif(Datenum()>=1210507 and Datenum()<=1210512,1210512,	Iif(Datenum()>=1210513 and Datenum()<=1210520,1210520,	Iif(Datenum()>=1210521 and Datenum()<=1210527,1210527,	Iif(Datenum()>=1210528 and Datenum()<=1210603,1210603,	Iif(Datenum()>=1210604 and Datenum()<=1210610,1210610,	Iif(Datenum()>=1210611 and Datenum()<=1210617,1210617,	Iif(Datenum()>=1210618 and Datenum()<=1210624,1210624,	Iif(Datenum()>=1210625 and Datenum()<=1210701,1210701,	Iif(Datenum()>=1210702 and Datenum()<=1210708,1210708,	Iif(Datenum()>=1210709 and Datenum()<=1210715,1210715,	Iif(Datenum()>=1210716 and Datenum()<=1210722,1210722,	Iif(Datenum()>=1210723 and Datenum()<=1210729,1210729,	Iif(Datenum()>=1210730 and Datenum()<=1210805,1210805,	Iif(Datenum()>=1210806 and Datenum()<=1210812,1210812,	Iif(Datenum()>=1210813 and Datenum()<=1210818,1210818,	Iif(Datenum()>=1210819 and Datenum()<=1210826,1210826,	Iif(Datenum()>=1210827 and Datenum()<=1210902,1210902,	Iif(Datenum()>=1210903 and Datenum()<=1210909,1210909,	Iif(Datenum()>=1210910 and Datenum()<=1210916,1210916,	Iif(Datenum()>=1210917 and Datenum()<=1210923,1210923,	Iif(Datenum()>=1210924 and Datenum()<=1210930,1210930,	Iif(Datenum()>=1211001 and Datenum()<=1211007,1211007,	Iif(Datenum()>=1211008 and Datenum()<=1211014,1211014,	Iif(Datenum()>=1211015 and Datenum()<=1211021,1211021,	Iif(Datenum()>=1211022 and Datenum()<=1211028,1211028,	Iif(Datenum()>=1211029 and Datenum()<=1211103,1211103,	Iif(Datenum()>=1211104 and Datenum()<=1211111,1211111,	Iif(Datenum()>=1211112 and Datenum()<=1211118,1211118,	Iif(Datenum()>=1211119 and Datenum()<=1211125,1211125,	Iif(Datenum()>=1211126 and Datenum()<=1211202,1211202,	Iif(Datenum()>=1211203 and Datenum()<=1211209,1211209,	Iif(Datenum()>=1211210 and Datenum()<=1211216,1211216,	Iif(Datenum()>=1211217 and Datenum()<=1211223,1211223,	Iif(Datenum()>=1211224 and Datenum()<=1211230,1211230,	Iif(Datenum()>=1211231 and Datenum()<=1220106,1220106,	Iif(Datenum()>=1220107 and Datenum()<=1220113,1220113,	Iif(Datenum()>=1220114 and Datenum()<=1220120,1220120,	Iif(Datenum()>=1220121 and Datenum()<=1220127,1220127,	Iif(Datenum()>=1220128 and Datenum()<=1220203,1220203,	Iif(Datenum()>=1220204 and Datenum()<=1220210,1220210,	Iif(Datenum()>=1220211 and Datenum()<=1220217,1220217,	Iif(Datenum()>=1220218 and Datenum()<=1220224,1220224,	Iif(Datenum()>=1220225 and Datenum()<=1220303,1220303,	Iif(Datenum()>=1220304 and Datenum()<=1220310,1220310,	Iif(Datenum()>=1220311 and Datenum()<=1220317,1220317,	Iif(Datenum()>=1220318 and Datenum()<=1220324,1220324,	Iif(Datenum()>=1220325 and Datenum()<=1220331,1220331,	Iif(Datenum()>=1220401 and Datenum()<=1220407,1220407,	Iif(Datenum()>=1220408 and Datenum()<=1220413,1220413,	Iif(Datenum()>=1220414 and Datenum()<=1220421,1220421,	Iif(Datenum()>=1220422 and Datenum()<=1220428,1220428,	Iif(Datenum()>=1220429 and Datenum()<=1220505,1220505,	Iif(Datenum()>=1220506 and Datenum()<=1220512,1220512,	Iif(Datenum()>=1220513 and Datenum()<=1220519,1220519,	Iif(Datenum()>=1220520 and Datenum()<=1220526,1220526,	Iif(Datenum()>=1220527 and Datenum()<=1220602,1220602,	Iif(Datenum()>=1220603 and Datenum()<=1220609,1220609,	Iif(Datenum()>=1220610 and Datenum()<=1220616,1220616,	Iif(Datenum()>=1220617 and Datenum()<=1220623,1220623,	Iif(Datenum()>=1220624 and Datenum()<=1220630,1220630,	Iif(Datenum()>=1220701 and Datenum()<=1220707,1220707,	Iif(Datenum()>=1220708 and Datenum()<=1220714,1220714,	Iif(Datenum()>=1220715 and Datenum()<=1220721,1220721,	Iif(Datenum()>=1220722 and Datenum()<=1220728,1220728,	Iif(Datenum()>=1220729 and Datenum()<=1220804,1220804,	Iif(Datenum()>=1220805 and Datenum()<=1220811,1220811,	Iif(Datenum()>=1220812 and Datenum()<=1220818,1220818,	Iif(Datenum()>=1220819 and Datenum()<=1220825,1220825,	Iif(Datenum()>=1220826 and Datenum()<=1220901,1220901,	Iif(Datenum()>=1220902 and Datenum()<=1220908,1220908,	Iif(Datenum()>=1220909 and Datenum()<=1220915,1220915,	Iif(Datenum()>=1220916 and Datenum()<=1220922,1220922,	Iif(Datenum()>=1220923 and Datenum()<=1220929,1220929,	Iif(Datenum()>=1220930 and Datenum()<=1221006,1221006,	Iif(Datenum()>=1221007 and Datenum()<=1221013,1221013,	Iif(Datenum()>=1221014 and Datenum()<=1221020,1221020,	Iif(Datenum()>=1221021 and Datenum()<=1221027,1221027,	Iif(Datenum()>=1221028 and Datenum()<=1221103,1221103,	Iif(Datenum()>=1221104 and Datenum()<=1221110,1221110,	Iif(Datenum()>=1221111 and Datenum()<=1221117,1221117,	Iif(Datenum()>=1221118 and Datenum()<=1221124,1221124,	Iif(Datenum()>=1221125 and Datenum()<=1221201,1221201,	Iif(Datenum()>=1221202 and Datenum()<=1221208,1221208,	Iif(Datenum()>=1221209 and Datenum()<=1221215,1221215,	Iif(Datenum()>=1221216 and Datenum()<=1221222,1221222,	Iif(Datenum()>=1221223 and Datenum()<=1221229,1221229,	Iif(Datenum()>=1221230 and Datenum()<=1230105,1230105,	Iif(Datenum()>=1230106 and Datenum()<=1230112,1230112,	Iif(Datenum()>=1230113 and Datenum()<=1230119,1230119,	Iif(Datenum()>=1230120 and Datenum()<=1230125,1230125,	Iif(Datenum()>=1230126 and Datenum()<=1230202,1230202,	Iif(Datenum()>=1230203 and Datenum()<=1230209,1230209,	Iif(Datenum()>=1230210 and Datenum()<=1230216,1230216,	Iif(Datenum()>=1230217 and Datenum()<=1230223,1230223,	Iif(Datenum()>=1230224 and Datenum()<=1230302,1230302,	Iif(Datenum()>=1230303 and Datenum()<=1230309,1230309,	Iif(Datenum()>=1230310 and Datenum()<=1230316,1230316,	Iif(Datenum()>=1230317 and Datenum()<=1230323,1230323,	Iif(Datenum()>=1230324 and Datenum()<=1230329,1230329,Null)))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))));



expiryday = IIf(DateNum()==expday,1,0);

BUY1 = IIf(PSARFinal<FinalStockEQClose,1,0);

Ticker = Name(); 
//check based on symbol name -- might even be different for weekly
TickerStrikeHelper = StrMid(Ticker,num,-1); 
TickerStrikeHelper1 = StrRight(TickerStrikeHelper,2);
TickerStrike = WriteIf(TickerStrikeHelper1 == "CE",StrReplace(TickerStrikeHelper,"CE",""),StrReplace(TickerStrikeHelper,"PE",""));
TickerStrikeNum = StrToNum(TickerStrike);
CEPE = StrLeft(StrRight(Ticker,4),2);//StrLeft(TickerStrikeHelper1,2);
 


TimeFrameSet(y);
ATMStrike_a = Aux1;
Premium_a=Close;;
TimeFrameRestore();

ATMStrike = TimeFrameExpand(ATMStrike_a,y,expandFirst);
//ATMStrike = round(FinalStockEQClose/100)*100;
Premium= TimeFrameExpand(Premium_a,y,expandFirst);

Signal1 = IIf(ATMStrike == TickerStrikeNum,1,0);
Signal2Helper = WriteIf(CEPE == "CE","1","0");
Signal2 = StrToNum(Signal2Helper);

DTE = expday - DateNum();

FinalSignalPEStock = IIf((BUY1 == 1) AND (Signal1 == 1) AND (Signal2 == 0),1,0);
FinalSignalCEStock = IIf((BUY1 == 0) AND (Signal1 == 1) AND (Signal2 == 1),1,0);
cepe_check="";
Short = IIf((TimeNum()>= 091500) AND (IIf(expiryday==1,IIf(cases==1,(TimeNum()<152000),TimeNum()<151500),(TimeNum()<=152500))) AND (Premium>0),IIf(CEPE == "CE", FinalSignalCEStock,FinalSignalPEStock),0);
Cover = IIf(IIf(expiryday==1,TimeNum()>=091500,((TimeNum()>=091500) AND (TimeNum()<=152500))),(Ref(expday,1)!=expday) OR IIf(Signal2 == 1, BUY1 == 1, BUY1 == 0),0);
cepe_check=WriteIf(Short,cepe,cepe_check);
ShortPrice = Premium;
CoverPrice = Premium;

//SetTradeDelays(0,0,1,0); // THIS WILL CHANGE WHEN YOU DO BUY SELL
SetTradeDelays(0,0,0,0);

SetForeign("Fixed"+"$NIFTY_BANK"+"-NSE - I");
eq_close=Close;
Dayopen=TimeFrameGetPrice("O",inDaily);
eq_open=open;
RestorePriceArrays();



leverage = 1; 
BN_ticker=IIf(StrLeft(Name(),9)=="BANKNIFTY",1,0);
BN_strike=StrToNum(StrLeft(StrRight(Name(),9),5));
bn_ce=IIf(bn_ticker AND StrLeft(StrRight(Name(),4),2)=="CE",1,IIf(StrLeft(StrRight(Name(),4),2)=="PE",0,2));
ATMStrike_bn = round(EQ_close/100)*100;
bn_atm=atmstrike_bn==bn_strike;

Buy= DateNum()!=Ref(DateNum(),1) AND IIf(buy1,bn_ce,bn_ce==0) AND bn_ticker AND expiryday==0 AND bn_atm;//IIf(cepe_check=="CE",bn_ce==0,0)AND IIf(cepe_check=="PE",bn_ce,0)
Sell=DateNum()!=Ref(DateNum(),-1);
BuyPrice=Close;
SellPrice=Open;
Buy=ExRem(Buy,Sell);
sell=ExRem(sell,Buy);


StaticVarSet("Stock_Close",FinalStockEQClose);
StaticVarSet("PSAR",PSARFinal);
//StaticVarSet("Days_to_Expiry",DTE);
stock_exposure=0;
d1=DateNum();
SetCustomBacktestProc("");
if(Status("action") == actionPortfolio)   
{   
	
	bo = GetBacktesterObject();
	Cc=0;
	bo.PreProcess();
	for (i = 0; i<BarCount; i++)
	{
		CurrentPortfolioEquity = bo.Equity;
		for (sig = bo.GetFirstSignal(i) ; sig ; sig = bo.GetNextSignal(i))
		{
			/*
			if(cc==0){
				cc=cc+1;
			}
			*/
			//else{
			//if(IIf(StrLeft(Name(),9)=="BANKNIFTY",1,0)){
			SetForeign("Fixed"+sym+".EQ-NSE - I");
			TimeFrameSet(y);
			EQClose1 = Close;
			RestorePriceArrays();
			StockEQClose = TimeFrameExpand(EQClose1,y,expandFirst); 
			//method 1
			
			Total_Equity = CurrentPortfolioEquity * leverage;
			NumberOfShares = Total_Equity / StockEQClose[i];
			sig.PosSize = NumberOfShares[i] * sig.Price;
			//IIf(sig.Type==3,
			exposure=NumberOfShares[i]*StockEQClose[i];///leverage;
			
			//}
			
			if(StrLeft(sig.Symbol(),9)=="BANKNIFTY") //(IIf(StrLeft(Name(),9)=="BANKNIFTY",0,1))
			{
				SetForeign("Fixed"+"$NIFTY_BANK"+"-NSE - I");
				TimeFrameSet(y);
				eq_close1=Close;
				RestorePriceArrays();
				SetForeign("Fixed"+sym+".EQ-NSE - I");
				TimeFrameSet(y);
				EQClose1 = Close;
				RestorePriceArrays();
				StockEQClose = TimeFrameExpand(EQClose1,y,expandFirst); 
				eq_close2 = TimeFrameExpand(eq_close1,y,expandFirst); 
				sig.PosSize=exposure/eq_close2[i]*sig.Price();

			}
			//}
			
			/*
			// method 2
			MarginPerShare = StockEQClose[i] / leverage;
			size = 100; //1 sps of EQ
			minimumpremium = (size/100)*MarginPerShare;
			sig.PosSize = IIf(sig.Price >= minimumpremium,-size,(-size/100)*sig.Price/minimumpremium*100);
			*/
		}
		bo.ProcessTradeSignals(i) ;
	}
	
	
	
	for ( trade = bo.GetFirstTrade() ; trade ; trade = bo.GetNextTrade()  )
		{
		
			StockClose = StaticVarGet("Stock_Close");
			PSAR_Value = StaticVarGet("PSAR");
			//D_T_E = StaticVarGet("Days_to_Expiry");
			  
			trade.AddCustomMetric("Stock__Close",Lookup(StockClose, trade.EntryDateTime,0)) ;
			trade.AddCustomMetric("PSARValue",Lookup(PSAR_Value, trade.EntryDateTime,0)) ;
			//trade.AddCustomMetric("Days_to_Expiry",Lookup(D_T_E, trade.EntryDateTime,0)) ;
				  
		  
		}
		
	
	bo.PostProcess();
	
	//AddToComposite(bo.EquityArray,"~No.sharesnewnew~" + sym +"_TF:"+ y/60 + "_PSAR:" + ACC + "MinPrem" + "_lev_"+leverage+ "_Short"   ,"C",atcFlagDeleteValues | atcFlagEnableInPortfolio );
   
				
}   



Filter = 1;
AddColumn(PSARFinal,"PSARFinal",1.2);
AddColumn(FinalStockEQClose,"FinalStockEQClose",1.2);
AddColumn(BN_ticker,"BN_ticker",1.2);
AddColumn(BN_strike,"BN_strike",1.2);
AddColumn(ATMStrike_bn,"ATMStrike_bn",1.2);
AddColumn(bn_atm,"bn_atm",1.2);
AddColumn(bn_ce,"bn_ce",1.2);
AddColumn(buy1,"buy1",1.2);
//AddColumn(var,"var",1.2);

AddColumn(DateNum()!=Ref(DateNum(),1),"DateNum()!=Ref(DateNum(),1)");
AddColumn(expiryday,"expiryday",1.2);
AddColumn(IIf(buy1,bn_ce,bn_ce==0),"IIf(buy1,bn_ce,bn_ce==0)",1.2);

AddColumn(IIf(bn_ce, FinalSignalpEStock,FinalSignalcEStock),"IIf(bn_ce, FinalSignalCEStock,FinalSignalPEStock)",1.2);

AddColumn(buy,"buy",1.2);
AddColumn(short,"short",1.2);




